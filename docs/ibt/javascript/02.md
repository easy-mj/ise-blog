---
layout: doc
---

# é¢å‘å¯¹è±¡ç¼–ç¨‹/åŸå‹åŠåŸå‹é“¾

::: tip çŸ¥è¯†ç‚¹

- å‚æ•°æŒ‰å€¼ä¼ é€’
- æ‰‹å†™ call å’Œ apply
- æ‰‹å†™ bind
- æ‰‹å†™æ¨¡æ‹Ÿ new
- ç±»æ•°ç»„å¯¹è±¡ å’Œ arguments
- åˆ›å»ºå¯¹è±¡çš„å¤šç§æ–¹å¼ & ä¼˜ç¼ºç‚¹
- ç»§æ‰¿çš„å¤šç§æ–¹å¼ & ä¼˜ç¼ºç‚¹

:::

::: details ç›®æ ‡

- åˆçº§ï¼šæŒæ¡ JavaScript åŸºç¡€ä½¿ç”¨
- ä¸­çº§ï¼šæŒæ¡ JavaScript è¯­æ³•çš„å¸¸è§é¢è¯•é¢˜åŠä½¿ç”¨æŠ€å·§
- é«˜çº§ï¼šæŒæ¡ JavaScript çš„æ ¸å¿ƒåŸç†å®ç°

:::

::: details èµ„æ–™

- å®˜ç½‘MDNï¼šhttps://developer.mozilla.org/en-US/docs/Web/JavaScript
- ç”»å›¾å·¥å…·ğŸ”§ï¼šhttps://www.processon.com/
- è±†åŒ…æ——ä¸‹çš„æ™ºèƒ½ç¼–ç¨‹åŠ©æ‰‹Trae AI: https://www.marscode.com/extension

:::


## 1. å‚æ•°æŒ‰å€¼ä¼ é€’

åœ¨ã€ŠJavaScripté«˜çº§ç¨‹åºè®¾è®¡ã€‹ä¸­æåˆ°ä¼ é€’å‚æ•°ï¼š
> ECMAScript ä¸­æ‰€æœ‰å‡½æ•°çš„å‚æ•°éƒ½æ˜¯æŒ‰å€¼ä¼ é€’çš„ã€‚

ä»€ä¹ˆæ˜¯æŒ‰å€¼ä¼ é€’å‘¢ï¼Ÿ
> æŒ‰å€¼ä¼ é€’æŒ‡çš„æ˜¯æŠŠå‡½æ•°å¤–éƒ¨çš„å€¼å¤åˆ¶ç»™å‡½æ•°å†…éƒ¨çš„å‚æ•°ï¼Œå°±å’ŒæŠŠå€¼ä»ä¸€ä¸ªå˜é‡å¤åˆ¶åˆ°å¦ä¸€ä¸ªå˜é‡ä¸€æ ·ã€‚

### 1.1 æŒ‰å€¼ä¼ é€’

ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼š
```js
var value = 1;
function foo(v) {
  v = 2
  console.log(v)  // 2
}
foo(value)
console.log(value)  // 1
```
ä¸Šé¢çš„ä»£ç å¾ˆå¥½ç†è§£ï¼Œå½“ä¼ é€’ `value` åˆ°å‡½æ•° `foo` ä¸­çš„æ—¶å€™ï¼Œç›¸å½“äºæ‹·è´äº†ä¸€ä»½ `value`ï¼Œå‡è®¾æ‹·è´çš„è¿™ä»½å« `_value`ï¼Œå‡½æ•°ä¸­ä¿®æ”¹çš„éƒ½æ˜¯ `_value` çš„å€¼ï¼Œè€Œä¸ä¼šå½±å“åŸæ¥çš„ `value` çš„å€¼ã€‚

### 1.2 å…±äº«ä¼ é€’

æ‹·è´è™½ç„¶å¾ˆå¥½ç†è§£ï¼Œä½†æ˜¯å½“å€¼æ˜¯ä¸€ä¸ªå¤æ‚çš„æ•°æ®ç»“æ„çš„æ—¶å€™ï¼Œæ‹·è´ä¼šäº§ç”Ÿæ€§èƒ½ä¸Šçš„é—®é¢˜ã€‚

è¿™é‡ŒæåŠä¸€ç§ï¼šæŒ‰å¼•ç”¨ä¼ é€’ã€‚

æ‰€è°“æŒ‰å¼•ç”¨ä¼ é€’ï¼Œå°±æ˜¯ä¼ é€’å¯¹è±¡çš„å¼•ç”¨ï¼Œå‡½æ•°å†…éƒ¨å¯¹å‚æ•°çš„ä»»ä½•æ”¹å˜éƒ½ä¼šå½±å“åˆ°è¯¥å¯¹è±¡çš„å€¼ï¼Œå› ä¸ºä¸¤è€…å¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚

ä¸¾ä¸ªä¾‹å­ï¼š
```js
var obj = {
  value: 1
}
function foo(o) {
  o.value = 2
  console.log(o.value)  // 2
}
foo(obj)
console.log(obj.value)  // 2
```

ä¸ºä»€ä¹ˆã€ŠJavaScripté«˜çº§ç¨‹åºè®¾è®¡ã€‹ä¸­è¯´æ‰€æœ‰å‡½æ•°çš„å‚æ•°éƒ½æ˜¯æŒ‰å€¼ä¼ é€’çš„ï¼Œé‚£ä¸ºä»€ä¹ˆèƒ½æŒ‰â€œå¼•ç”¨ä¼ é€’â€æˆåŠŸå‘¢ï¼Ÿ
``` js
var obj = {
  value: 1
}
function foo(o) {
  o = 2
  console.log(o)  // 2
}
foo(obj)
console.log(obj.value)  // 1
```

å¦‚æœ `JavaScript` é‡‡ç”¨çš„æ˜¯æŒ‰å¼•ç”¨ä¼ é€’ï¼Œå¤–å±‚çš„å€¼ä¹Ÿä¼šè¢«ä¿®æ”¹ï¼Œé‚£è¿™é‡Œå¦‚ä½•è§£é‡Šå‘¢ï¼Ÿ

è¿™å°±è¦è®²åˆ°ç¬¬äºŒç§ä¼ é€’æ–¹å¼ï¼Œå«â€œå…±äº«ä¼ é€’â€ã€‚

æ‰€è°“çš„å…±äº«ä¼ é€’æ˜¯æŒ‡ï¼Œåœ¨ä¼ é€’å¯¹è±¡çš„æ—¶å€™ï¼Œä¼ é€’çš„æ˜¯åœ°å€ç´¢å¼•ã€‚

æ‰€ä»¥ä¿®æ”¹ `o.value` ï¼Œå¯ä»¥é€šè¿‡å¼•ç”¨æ‰¾åˆ°åŸå€¼ï¼Œä½†æ˜¯ç›´æ¥ä¿®æ”¹ `o` ï¼Œå¹¶ä¸ä¼šä¿®æ”¹åŸå€¼ã€‚æ‰€ä»¥ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªä¾‹å­å…¶å®éƒ½æ˜¯æŒ‰å…±äº«ä¼ é€’ã€‚

æœ€åï¼Œä½ å¯ä»¥è¿™æ ·ç†è§£ï¼š

å‚æ•°å¦‚æœæ˜¯åŸºæœ¬ç±»å‹æ˜¯æŒ‰å€¼ä¼ é€’ï¼Œå¦‚æœæ˜¯å¼•ç”¨ç±»å‹æ˜¯æŒ‰å…±äº«ä¼ é€’ã€‚ä½†æ˜¯å› ä¸ºæ‹·è´å‰¯æœ¬ä¹Ÿæ˜¯ä¸€ç§å€¼çš„æ‹·è´ï¼Œæ‰€ä»¥åœ¨ã€ŠJavaScripté«˜çº§ç¨‹åºè®¾è®¡ã€‹ä¸­ä¹Ÿç›´æ¥è®¤ä¸ºæ˜¯æŒ‰å€¼ä¼ é€’äº†ã€‚æ¢å¥è¯è¯´ï¼Œå‡½æ•°ä¼ é€’å‚æ•°ï¼Œä¼ é€’çš„æ˜¯å‚æ•°çš„æ‹·è´ï¼š
- æŒ‡é’ˆæ‹·è´ï¼Œæ‹·è´çš„æ˜¯åœ°å€ç´¢å¼•
- å¸¸è§„ç±»å‹æ‹·è´ï¼Œæ‹·è´çš„æ˜¯å€¼

æ‰€ä»¥ï¼Œæ€»å…±æœ‰ä¸¤ç§ä¼ é€’æ–¹å¼ï¼šæŒ‰å€¼ä¼ é€’å’ŒæŒ‰å…±äº«ä¼ é€’ã€‚

### 1.3 æ€»ç»“

`JavaScript` ä¸­æ•°æ®ç±»å‹åˆ†ä¸ºåŸºæœ¬ç±»å‹ä¸å¼•ç”¨ç±»å‹ï¼š
- åŸºæœ¬ç±»å‹çš„å€¼å­˜å‚¨äºæ ˆå†…å­˜ä¸­ï¼Œä¼ é€’çš„å°±æ˜¯å½“å‰å€¼ï¼Œä¿®æ”¹ä¸ä¼šå½±å“åŸæœ‰çš„å˜é‡çš„å€¼
- å¼•ç”¨ç±»å‹çš„å€¼å…¶å®ä¹Ÿå­˜äºæ ˆå†…å­˜ä¸­ï¼Œåªæ˜¯å®ƒçš„å€¼æ˜¯æŒ‡å‘å †å†…å­˜å½“ä¸­å®é™…å€¼çš„ä¸€ä¸ªåœ°å€ï¼›ç´¢å¼•å¼•ç”¨ä¼ é€’ï¼Œä¼ é€’çš„æ˜¯åœ°å€ç´¢å¼•ï¼Œä¿®æ”¹ä¼šå½±å“åŸæœ‰çš„å˜é‡çš„å€¼

æ‰€ä»¥é’ˆå¯¹ä¸Šè¿°çš„å†…å®¹ï¼š

**ç¤ºä¾‹1**
``` js
var value = 1;
function foo(v) {
  v = 2
  console.log(v)  // 2
}
foo(value)
console.log(value)  // 1
```

å†…å­˜åˆ†å¸ƒ

- æ”¹å˜å‰ï¼š

<table>
  <tbody>
    <tr>
      <th colspan="2">æ ˆå†…å­˜</th>
      <th>å †å†…å­˜</th>
    </tr>
    <tr>
      <td>value</td>
      <td>1</td>
      <td></td>
    </tr>
    <tr>
      <td>v</td>
      <td>1</td>
      <td></td>
    </tr>
  </tbody>
</table>

- æ”¹å˜åï¼š

<table>
  <tbody>
    <tr>
      <th colspan="2">æ ˆå†…å­˜</th>
      <th>å †å†…å­˜</th>
    </tr>
    <tr>
      <td>value</td>
      <td>1</td>
      <td></td>
    </tr>
    <tr>
      <td>v</td>
      <td>2</td>
      <td></td>
    </tr>
  </tbody>
</table>

**ç¤ºä¾‹2**

``` js
var obj = {
  value: 1
}
function foo(o) {
  o.value = 2
  console.log(o.value)  // 2
}
foo(obj)
console.log(obj.value)  // 2
```

å†…å­˜åˆ†å¸ƒ

- æ”¹å˜å‰ï¼š

<table>
  <tbody>
    <tr>
      <th colspan="2">æ ˆå†…å­˜</th>
      <th>å †å†…å­˜</th>
    </tr>
    <tr>
      <td>obj</td>
      <td>æŒ‡é’ˆåœ°å€</td>
      <td>{ value: 1 }</td>
    </tr>
    <tr>
      <td>o</td>
      <td>æŒ‡é’ˆåœ°å€</td>
      <td>{ value: 1 }</td>
    </tr>
  </tbody>
</table>

- æ”¹å˜åï¼š

<table>
  <tbody>
    <tr>
      <th colspan="2">æ ˆå†…å­˜</th>
      <th>å †å†…å­˜</th>
    </tr>
    <tr>
      <td>obj</td>
      <td>æŒ‡é’ˆåœ°å€</td>
      <td>{ value: 2 }</td>
    </tr>
    <tr>
      <td>o</td>
      <td>æŒ‡é’ˆåœ°å€</td>
      <td>{ value: 2 }</td>
    </tr>
  </tbody>
</table>

**ç¤ºä¾‹3**

``` js
var obj = {
  value: 1
}
function foo(o) {
  o = 2
  console.log(o)  // 2
}
foo(obj)
console.log(obj.value)  // 1
```

å†…å­˜åˆ†å¸ƒ

- æ”¹å˜å‰ï¼š
<table>
  <tbody>
    <tr>
      <th colspan="2">æ ˆå†…å­˜</th>
      <th>å †å†…å­˜</th>
    </tr>
    <tr>
      <td>obj</td>
      <td>æŒ‡é’ˆåœ°å€</td>
      <td>{ value: 1 }</td>
    </tr>
    <tr>
      <td>o</td>
      <td>æŒ‡é’ˆåœ°å€</td>
      <td>{ value: 1 }</td>
    </tr>
  </tbody>
</table>

- æ”¹å˜åï¼š
<table>
  <tbody>
    <tr>
      <th colspan="2">æ ˆå†…å­˜</th>
      <th>å †å†…å­˜</th>
    </tr>
    <tr>
      <td>obj</td>
      <td>æŒ‡é’ˆåœ°å€</td>
      <td>{ value: 1 }</td>
    </tr>
    <tr>
      <td>o</td>
      <td>2</td>
      <td></td>
    </tr>
  </tbody>
</table>

## 2. æ‰‹å†™ call å’Œ apply

### 2.1 æ‰‹å†™ call

> call(): åœ¨ä½¿ç”¨ä¸€ä¸ªæŒ‡å®šçš„ this å€¼å’Œè‹¥å¹²ä¸ªæŒ‡å®šçš„å‚æ•°å€¼çš„å‰æä¸‹è°ƒç”¨æŸä¸ªå‡½æ•°æˆ–æ–¹æ³•ã€‚

``` js
let foo = {
  value: 1
}

function bar() {
  console.log(this.value)
}

bar.call(foo)  // 1
```

æ³¨æ„äº®ç‚¹ï¼š
- call æ”¹å˜äº† this çš„æŒ‡å‘ï¼ŒæŒ‡å‘åˆ° foo
- bar å‡½æ•°æ‰§è¡Œäº†

#### 2.1.1 ç¬¬ä¸€æ­¥

ä¸Šè¿°æ–¹å¼ç­‰åŒäºï¼š
``` js
let foo = {
  value: 1,
  bar: function() {
    console.log(this.value)
  }
}
foo.bar()  // 1
```

è¿™æ—¶å€™ `this` å°±æŒ‡å‘äº† `foo` ï¼Œä½†æ˜¯è¿™æ ·å´ç»™ `foo` å¯¹è±¡æœ¬èº«å¢åŠ äº†ä¸€ä¸ªå±æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ `delete` å†åˆ é™¤å®ƒå³å¯ã€‚

æ‰€ä»¥æˆ‘ä»¬æ¨¡æ‹Ÿçš„æ­¥éª¤å¯ä»¥åˆ†ä¸ºï¼š
```
1. å°†å‡½æ•°è®¾ä¸ºå¯¹è±¡çš„å±æ€§
2. æ‰§è¡Œè¯¥å‡½æ•°
3. åˆ é™¤è¯¥å‡½æ•°
```

ä»¥ä¸Šçš„ä¾‹å­ä¸ºä¾‹ï¼Œå°±æ˜¯ï¼š
``` js
// fn æ˜¯å¯¹è±¡çš„å±æ€§åï¼Œåæ­£æœ€åä¹Ÿæ˜¯è¦åˆ é™¤æ‰çš„ï¼Œå› æ­¤èµ·å•¥åå­—éƒ½å¯ä»¥
foo.fn = bar
foo.fn()
delete foo.fn
```

æ ¹æ®ä¸Šè¿°æ€è·¯ï¼Œæä¾›ä¸€ç‰ˆï¼š
``` js
Function.prototype.myCall = function(context) {
  // é¦–å…ˆè¦è·å–è°ƒç”¨callçš„å‡½æ•°ï¼Œç”¨thiså¯ä»¥è·å–
  context.fn = this
  context.fn()
  delete context.fn
}

// æµ‹è¯•
let foo = {
  value: 1
}
function bar() {
  console.log(this.value)
}
bar.myCall(foo)  // 1
```

#### 2.1.2 ç¬¬äºŒæ­¥

`call` é™¤äº†å¯ä»¥æŒ‡å®š `this`ï¼Œè¿˜å¯ä»¥æŒ‡å®šå‚æ•°
``` js
let foo = {
  value: 1
}
function bar(name, age) {
  console.log(name)
  console.log(age)
  console.log(this.value)
}
bar.call(foo, 'kevin', 18) // kevin 18 1
```

å¯ä»¥ä» `arguments` å¯¹è±¡ä¸­å–å€¼ï¼Œå–å‡ºç¬¬äºŒä¸ªåˆ°æœ€åä¸€ä¸ªå‚æ•°ï¼Œç„¶åæ”¾åˆ°ä¸€ä¸ªæ•°ç»„é‡Œã€‚

ä¸Šè¿°ä»£ç çš„ `arguments` ä¸­å–ç¬¬äºŒä¸ªåˆ°æœ€åä¸€ä¸ªçš„å‚æ•°
``` js
// ä»¥ä¸Šé¢çš„ä¾‹å­ä¸ºä¾‹ï¼Œæ­¤æ—¶çš„argumentsä¸ºï¼š
// arguments = {
//   0: foo,
//   1: 'kevin',
//   2: 18,
//   length: 3
// }
// å› ä¸º arguments æ˜¯ç±»æ•°ç»„å¯¹è±¡ï¼Œæ‰€ä»¥å¯ä»¥ç”¨ for å¾ªç¯
let args = []
for(let i = 1; i < arguments.length; i++) {
  args.push('arguments[' + i + ']')
}

// æ‰§è¡Œå args ä¸ºï¼š["arguments[1]", "arguments[2]", "arguments[3]"]
```

æ¥ä¸‹æ¥ä½¿ç”¨ `eval` æ‹¼æ¥æˆä¸€ä¸ªå‡½æ•°
``` js
eval('context.fn(' + args + ')')
```

è€ƒè™‘åˆ°ç›®å‰å¤§éƒ¨åˆ†æµè§ˆå™¨åœ¨ `console` ä¸­é™åˆ¶äº† `eval` çš„ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ `rest` æ¥å®ç°ï¼š
``` js
// ç¬¬äºŒç‰ˆ
Function.prototype.myCall = function(context) {
  context.fn = this
  let args = [...arguments].slice(1)
  context.fn(...args)
  delete context.fn
}

// æµ‹è¯•
let foo = {
  value: 1
}

function bar(name, age) {
  console.log(name)
  console.log(age)
  console.log(this.value) // 1  
}

bar.myCall(foo, 'kevin', 18) // kevin 18 1
```

#### 2.1.3 ç¬¬ä¸‰æ­¥

1. this å‚æ•°å¯ä»¥ä¼ é€’ nullï¼Œå½“ä¸º null çš„æ—¶å€™ï¼Œè§†ä¸ºæŒ‡å‘ window

ä¸¾ä¸ªä¾‹å­ï¼š
``` js
var value = 1;

function bar() {
  console.log(this.value);
}

bar.call(null); // 1
```

2. é’ˆå¯¹å‡½æ•°ï¼Œå¯ä»¥å®ç°è¿”å›å€¼

ä¸¾ä¸ªä¾‹å­ï¼š
``` js
var foo = {
  value: 1
}

function bar(name, age) {
  return {
    value: this.value,
    name: name,
    age: age
  }
}

console.log(bar.call(foo, 'kevin', 18))
// {
//   value: 1,
//   name: 'kevin',
//   age: 18
// }
```

è°ƒæ•´ç¬¬äºŒç‰ˆä»£ç ï¼š
``` js
// ç¬¬ä¸‰ç‰ˆ
Function.prototype.myCall = function(context) {
  var context = context || window
  context.fn = this

  let args = [...arguments].slice(1)
  let result = context.fn(...args)

  delete context.fn
  return result
}

// æµ‹è¯•
var value = 2

var obj = {
  value: 1
}

function bar(name, age) {
  console.log(this.value)
  return {
    value: this.value,
    name: name,
    age: age
  }
}

bar.myCall(null) // 2

console.log(bar.myCall(obj, 'kevin', 18))
// 1
// {
//   value: 1,
//   name: 'kevin',
//   age: 18
// }
```

æœ€ç®€åŒ–ç‰ˆçš„å†™æ³•ï¼š
``` js
Function.prototype.myCall = function(context, ...args) {
  if(typeof context === undefined || context === null) {
    context = window
  }
  let fnSymbol = Symbol()
  context[fnSymbol] = this
  let result = context[fnSymbol](...args)
  delete context[fnSymbol]
  return result
}
```

### 2.2 æ‰‹å†™ apply

`apply` çš„å®ç°è·Ÿ `call` ç±»ä¼¼ï¼Œåªæ˜¯ä¼ é€’çš„å‚æ•°ç±»å‹ä¸åŒï¼Œ`apply` ä¸ºæ•°ç»„ã€‚

``` js
Function.prototype.myApply = function(context, arr) {
  var context = Object(context) || window
  context.fn = this

  var result
  if (!arr) {
    result = context.fn()
  } else {
    result = context.fn(...arr)
  }

  delete context.fn
  return result
}
```

æœ€ç®€åŒ–ç‰ˆçš„å†™æ³•ï¼š
``` js
Function.prototype.myApply = function(context, arr = []) {
  // åˆ¤æ–­æ˜¯å¦æ˜¯ undefined å’Œ null
  if(typeof context === undefined || context === null) {
    context = window
  }

  let fnSymbol = Symbol()
  context[fnSymbol] = this
  let result = context[fnSymbol](...arr)

  delete context[fnSymbol]
  return result
}
```

## 3. æ‰‹å†™ bind
> bind(): åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œåœ¨ bind() è¢«è°ƒç”¨æ—¶ï¼Œè¿™ä¸ªæ–°å‡½æ•°çš„ this è¢«æŒ‡å®šä¸º bind() çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè€Œå…¶ä½™å‚æ•°å°†ä½œä¸ºæ–°å‡½æ•°çš„å‚æ•°ï¼Œä¾›è°ƒç”¨æ—¶ä½¿ç”¨ã€‚

ç”±æ­¤æˆ‘ä»¬å¯ä»¥é¦–å…ˆå¾—å‡º `bind` å‡½æ•°çš„ä¸¤ä¸ªç‰¹ç‚¹ï¼š
- è¿”å›ä¸€ä¸ªå‡½æ•°
- å¯ä»¥ä¼ å…¥å‚æ•°

### 3.1 è¿”å›å‡½æ•°çš„æ¨¡æ‹Ÿå®ç°
``` js
var foo = {
  value: 1
}

function bar() {
  console.log(this.value)
}

// è¿”å›äº†ä¸€ä¸ªå‡½æ•°
var bindFoo = bar.bind(foo)

bindFoo() // 1
```

å…³äºæŒ‡å®š `this` çš„æŒ‡å‘ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `call` æˆ–è€… `apply` æ¥å®ç°ã€‚
``` js
// ç¬¬ä¸€ç‰ˆ
Function.prototype.myBind = function(context) {
  var self = this

  return function() {
    // è€ƒè™‘åˆ°ç»‘å®šå‡½æ•°å¯èƒ½æœ‰è¿”å›å€¼ï¼Œæ‰€ä»¥åŠ ä¸Š return
    return self.apply(context)
  }
}
```

### 3.2 ä¼ å‚çš„æ¨¡æ‹Ÿå®ç°

æ¥ä¸‹æ¥ï¼Œå…³äºå‚æ•°çš„ä¼ é€’ï¼š
``` js
var foo = {
  value: 1
}

function bar(name, age) {
  console.log(name)
  console.log(age)
  console.log(this.value)
}

var bindFoo = bar.bind(foo, 'daisy')
bindFoo('18') // daisy 18 1
```

å½“éœ€è¦ä¼  `name` å’Œ `age` ä¸¤ä¸ªå‚æ•°æ—¶ï¼Œå¯ä»¥åœ¨ `bind` çš„æ—¶å€™ï¼Œåªä¼ ä¸€ä¸ª `name`ï¼Œåœ¨æ‰§è¡Œè¿”å›çš„å‡½æ•°çš„æ—¶å€™ï¼Œå†ä¼ å¦ä¸€ä¸ªå‚æ•° `age`ã€‚

è¿™é‡Œå¦‚æœä¸é€‚ç”¨ `rest`ï¼Œä½¿ç”¨ `arguments` æ¥è¿›è¡Œå¤„ç†ï¼š
``` js
// ç¬¬äºŒç‰ˆ
Function.prototype.myBind = function(context) {
  var self = this

  // è·å– myBind å‡½æ•°ä»ç¬¬äºŒä¸ªåˆ°æœ€åä¸€ä¸ªå‚æ•°
  var args = Array.prototype.slice.call(arguments, 1)

  return function() {
    // è¿™ä¸ªæ—¶å€™çš„ arguments æ˜¯ bind è¿”å›çš„å‡½æ•°ä¼ å…¥çš„å‚æ•°
    var bindArgs = Array.prototype.slice.call(arguments)
    return self.apply(context, args.concat(bindArgs))
  }
}
```

### 3.3 æ„é€ å‡½æ•°æ•ˆæœçš„æ¨¡æ‹Ÿå®ç°

`bind` è¿˜æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯
> ä¸€ä¸ªç»‘å®šå‡½æ•°ä¹Ÿèƒ½ä½¿ç”¨`new`æ“ä½œç¬¦åˆ›å»ºå¯¹è±¡ï¼šè¿™ç§è¡Œä¸ºå°±åƒæŠŠåŸå‡½æ•°å½“æˆæ„é€ å™¨ã€‚æä¾›çš„ this å€¼è¢«å¿½ç•¥ï¼ŒåŒæ—¶è°ƒç”¨æ—¶çš„å‚æ•°è¢«æä¾›ç»™æ¨¡æ‹Ÿå‡½æ•°ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼šå½“ `bind` è¿”å›çš„å‡½æ•°ä½œä¸ºæ„é€ å‡½æ•°çš„æ—¶å€™ï¼Œ`bind` æ—¶æŒ‡å®šçš„ `this` å€¼ä¼šå¤±æ•ˆï¼Œä½†ä¼ å…¥çš„å‚æ•°ä¾ç„¶ç”Ÿæ•ˆã€‚

ä¸¾ä¸ªä¾‹å­ï¼š
``` js
var value = 2

var foo = {
  value: 1
}

function bar(name, age) {
  this.habit = 'shopping'
  console.log(this.value)
  console.log(name)
  console.log(age)
}

bar.prototype.friend = 'kevin'

var bindFoo = bar.bind(foo, 'daisy')

var obj = new bindFoo('18')
// undefined daisy 18

console.log(obj.habit)
console.log(obj.friend)
// shopping kevin
```

å°½ç®¡åœ¨å…¨å±€å’Œ `foo` ä¸­éƒ½å£°æ˜äº† `value` å€¼ï¼Œæœ€åä¾ç„¶è¿”å›äº† `undefined`ï¼Œè¯´æ˜ç»‘å®šçš„ `this` å¤±æ•ˆäº†ã€‚
> åé¢çš„ new çš„æ¨¡å¼å®ç°ï¼Œå°±ä¼šçŸ¥é“è¿™ä¸ªæ—¶å€™çš„ this å·²ç»æŒ‡å‘äº† objã€‚

``` js
// ç¬¬ä¸‰ç‰ˆ
Function.prototype.myBind = function(context) {
  var self = this
  var args = Array.prototype.slice.call(arguments, 1)

  var fnBind = function() {
    var bindArgs = Array.prototype.slice.call(arguments)
    // å½“ä½œä¸ºæ„é€ å‡½æ•°æ—¶ï¼Œthis æŒ‡å‘å®ä¾‹ï¼Œæ­¤æ—¶ç»“æœä¸º trueï¼Œå°†ç»‘å®šå‡½æ•°çš„ this æŒ‡å‘è¯¥å®ä¾‹ï¼Œå¯ä»¥è®©å®ä¾‹è·å¾—æ¥è‡ªç»‘å®šå‡½æ•°çš„å€¼
    // ä»¥ä¸Šé¢çš„ç¤ºä¾‹ä¸ºä¾‹ï¼Œå¦‚æœæ”¹æˆ `this instanceof fnBind ? null : context`ï¼Œå®ä¾‹åªæ˜¯ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œå°† null æ”¹æˆ this ï¼Œå®ä¾‹ä¼šå…·æœ‰ habit å±æ€§
    // å½“ä½œä¸ºæ™®é€šå‡½æ•°æ—¶ï¼Œthis æŒ‡å‘ windowï¼Œæ­¤æ—¶ç»“æœä¸º falseï¼Œå°†ç»‘å®šå‡½æ•°çš„ this æŒ‡å‘ context
    return self.apply(this instanceof fnBind ? this : context, args.concat(bindArgs))
  }

  // ä¿®æ”¹è¿”å›å‡½æ•°çš„ prototype ä¸ºç»‘å®šå‡½æ•°çš„ prototypeï¼Œå®ä¾‹å°±å¯ä»¥ç»§æ‰¿ç»‘å®šå‡½æ•°çš„åŸå‹ä¸­çš„å€¼
  fnBind.prototype = this.prototype
  return fnBind
}
```

### 3.4 æ„é€ å‡½æ•°æ•ˆæœçš„ä¼˜åŒ–å®ç°

ä½†æ˜¯åœ¨è¿™ä¸ªå†™æ³•ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥å°† `fnBind.prototype = this.prototype`ï¼Œæˆ‘ä»¬ç›´æ¥ä¿®æ”¹äº† `fnBind.prototype` çš„æ—¶å€™ï¼Œä¹Ÿä¼šç›´æ¥ä¿®æ”¹ç»‘å®šå‡½æ•°çš„ `prototype`ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªç©ºå‡½æ•°æ¥è¿›è¡Œä¸­è½¬ï¼š
``` js
// ç¬¬å››ç‰ˆ
Function.prototype.myBind = function(context) {
  var self = this
  var args = Array.prototype.slice.call(arguments, 1)

  var fNOP = function() {}

  var fnBind = function() {
    var bindArgs = Array.prototype.slice.call(arguments)
    return self.apply(this instanceof fnBind? this : context, args.concat(bindArgs))
  }

  fNOP.prototype = this.prototype
  fnBind.prototype = new fNOP()
  return fnBind
}
```

### 3.5 æœ€ç»ˆç‰ˆ

è°ƒç”¨ `bind` ä¸æ˜¯å‡½æ•°æ—¶ï¼Œæç¤ºé”™è¯¯ï¼š
``` js
if (typeof this !== "function") {
  throw new Error("Function.prototype.bind - what is trying to be bound is not callable");
}
```

æœ€ç»ˆä»£ç ä¸ºï¼š
``` js
Function.prototype.myBind = function(context) {
  if (typeof this!== "function") {
    throw new Error("Function.prototype.bind - what is trying to be bound is not callable");
  }

  var self = this
  var args = Array.prototype.slice.call(arguments, 1)

  var fNOP = function() {}

  var fnBind = function() {
    var bindArgs = Array.prototype.slice.call(arguments)
    return self.apply(this instanceof fnBind? this : context, args.concat(bindArgs))
  }

  fNOP.prototype = this.prototype
  fnBind.prototype = new fNOP()
  return fnBind
}
```

æœ€ç®€åŒ–ç‰ˆï¼š
``` js
Function.prototype.myBind = function(context) {
  // åˆ¤æ–­æ˜¯å¦æ˜¯ undefined å’Œ null
  if(typeof context === undefined || context === null) {
    context = window
  }

  let self = this
  return function(...args) {
    return self.apply(context, args)
  }
}
```

## 4. æ‰‹å†™æ¨¡æ‹Ÿ new

`new` è¿ç®—ç¬¦åˆ›å»ºä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„å¯¹è±¡ç±»å‹çš„å®ä¾‹æˆ–å…·æœ‰æ„é€ å‡½æ•°çš„å†…ç½®å¯¹è±¡ç±»å‹ä¹‹ä¸€ã€‚

å…ˆçœ‹çœ‹ `new` å®ç°äº†å“ªäº›åŠŸèƒ½ã€‚
``` js
function Person(name, age) {
  this.name = name
  this.age = age
  this.habit = 'shopping'
}

Person.prototype.friend = 'kevin'

Person.prototype.sayName = function() {
  console.log(`my name is ${this.name}`)
}

var person = new Person('daisy', 18)
console.log(person.name) // daisy
console.log(person.age) // 18
console.log(person.habit) // shopping
console.log(person.friend) // kevin
person.sayName() // my name is daisy
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå®ä¾‹ `person` å¯ä»¥ï¼š
- è®¿é—®åˆ° `Person` æ„é€ å‡½æ•°é‡Œçš„å±æ€§
- è®¿é—®åˆ° `Person` åŸå‹é“¾ä¸Šçš„å±æ€§

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥æ¨¡æ‹Ÿ `new` çš„å®ç°ã€‚

å› ä¸º `new` æ˜¯å…³é”®å­—ï¼Œæ‰€ä»¥æ— æ³•åƒ `bind` å‡½æ•°ä¸€æ ·ç›´æ¥è¦†ç›–ï¼Œæ‰€ä»¥æˆ‘ä»¬å†™ä¸€ä¸ªå‡½æ•°ï¼Œå‘½åä¸º `objectFactory`ï¼Œç”¨æ¥æ¨¡æ‹Ÿ `new` çš„å®ç°ã€‚ä½¿ç”¨çš„æ—¶å€™æ˜¯è¿™æ ·çš„ï¼š
``` js
function Person(name, age) {
  this.name = name
  this.age = age
  this.habit ='shopping'
}

// ä½¿ç”¨ new 
var person = new Person('daisy', 18)
// ä½¿ç”¨ objectFactory
var person = objectFactory(Person, 'daisy', 18)
```

### 4.1 åˆæ­¥å®ç°

å› ä¸º `new` çš„ç»“æœæ˜¯ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œæ‰€ä»¥åœ¨æ¨¡æ‹Ÿå®ç°çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿè¦å»ºç«‹ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå‡è®¾è¿™ä¸ªå¯¹è±¡å« `obj`ï¼Œå› ä¸º `obj` ä¼šå…·æœ‰ `Person` æ„é€ å‡½æ•°é‡Œçš„å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `Person.apply(obj, arguments)` æ¥ç»™ `obj` æ·»åŠ æ–°çš„å±æ€§ã€‚ç„¶åï¼Œå®ä¾‹çš„ `proto` å±æ€§ä¼šæŒ‡å‘æ„é€ å‡½æ•°çš„ `prototype`ï¼Œä¹Ÿæ­£æ˜¯å› ä¸ºå»ºç«‹èµ·è¿™æ ·çš„å…³ç³»ï¼Œå®ä¾‹å¯ä»¥è®¿é—®åŸå‹ä¸Šçš„å±æ€§ã€‚
``` js
// ç¬¬ä¸€ç‰ˆ
function objectFactory() {
  var obj = new Object()
  var Constructor = [].shift.call(arguments)
  obj.__proto__ = Constructor.prototype
  Constructor.apply(obj, arguments)
  return obj
}
```

åœ¨è¿™ä¸€ç‰ˆä¸­ï¼Œæˆ‘ä»¬ï¼š
1. ä½¿ç”¨ `new Object()` çš„æ–¹å¼æ–°å»ºä¸€ä¸ªå¯¹è±¡ `obj`ï¼›
2. å–å‡ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå°±æ˜¯æˆ‘ä»¬è¦ä¼ å…¥çš„æ„é€ å‡½æ•°ã€‚æ­¤å¤–å› ä¸º `shift` ä¼šä¿®æ”¹åŸæ•°ç»„ï¼Œæ‰€ä»¥ `arguments` ä¼šè¢«å»é™¤ç¬¬ä¸€ä¸ªå‚æ•°ï¼› 
3. å°† `obj` çš„åŸå‹æŒ‡å‘æ„é€ å‡½æ•°ï¼Œè¿™æ · `obj` å°±å¯ä»¥è®¿é—®åˆ°æ„é€ å‡½æ•°åŸå‹ä¸­çš„å±æ€§ï¼›
4. ä½¿ç”¨ `apply` ï¼Œæ”¹å˜æ„é€ å‡½æ•° `this` çš„æŒ‡å‘åˆ°æ–°å»ºçš„å¯¹è±¡ï¼Œè¿™æ · `obj` å°±å¯ä»¥è®¿é—®åˆ°æ„é€ å‡½æ•°ä¸­çš„å±æ€§ã€‚
5. è¿”å› `obj`ã€‚

æµ‹è¯•ï¼š
``` js
function Person(name, age) {
  this.name = name
  this.age = age
  this.habit ='shopping'
}

Person.prototype.friend = 'kevin'
Person.prototype.sayName = function() {
  console.log(`my name is ${this.name}`)
}

var person = objectFactory(Person, 'daisy', 18)
console.log(person.name) // daisy
console.log(person.age) // 18
console.log(person.habit) // shopping
console.log(person.friend) // kevin
person.sayName() // my name is daisy
```

### 4.2 æœ€ç»ˆå®ç°

å‡å¦‚æ„é€ å‡½æ•°æœ‰è¿”å›å€¼
``` js
function Person(name, age) {
  this.name = name
  this.age = age
  this.habit ='shopping'
  
  return {
    name: 'kevin',
    age: 18
  }
}

var person = new Person('daisy', 18)

console.log(person.name) // kevin
console.log(person.age) // 18
console.log(person.habit) // undefined
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ„é€ å‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨å®ä¾‹ `person` ä¸­ï¼Œåªèƒ½è®¿é—®è¿”å›çš„å¯¹è±¡ä¸­çš„å±æ€§ã€‚è€Œä¸”è¿˜è¦æ³¨æ„ä¸€ç‚¹ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬æ˜¯è¿”å›äº†ä¸€ä¸ªå¯¹è±¡ï¼Œå‡å¦‚æˆ‘ä»¬åªæ˜¯è¿”å›ä¸€ä¸ªåŸºæœ¬ç±»å‹çš„å€¼å‘¢ï¼Ÿ

å†ä¸¾ä¸ªä¾‹å­ï¼š
``` js
function Person(name, age) {
  this.name = name
  this.age = age
  this.habit ='shopping'

  return '123'
}

var person = new Person('daisy', 18)

console.log(person.name) // daisy
console.log(person.age) // 18
console.log(person.habit) // shopping
```

è¿™æ¬¡å°½ç®¡æœ‰è¿”å›å€¼ï¼Œä½†æ˜¯ç›¸å½“äºæ²¡æœ‰è¿”å›å€¼è¿›è¡Œå¤„ç†ã€‚

æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦åˆ¤æ–­è¿”å›å€¼æ˜¯ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬å°±è¿”å›è¿™ä¸ªå¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œæˆ‘ä»¬è¯¥è¿”å›ä»€ä¹ˆå°±è¿”å›ä»€ä¹ˆã€‚

``` js
// æœ€ç»ˆç‰ˆ
function objectFactory() {
  var obj = new Object()
  var Constructor = [].shift.call(arguments)
  obj.__proto__ = Constructor.prototype
  var result = Constructor.apply(obj, arguments)
  return typeof result === 'object' ? result : obj
}
```